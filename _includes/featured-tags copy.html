{% comment %}
  Featured tags built from: research, festival, moderation, poetry
  Uses site.featured-tags and site.featured-condition-size like the original.
{% endcomment %}

{% if site.featured-tags %}
<section>
  {% if include.bottom %}
    <hr class="hidden-sm hidden-xs">
  {% endif %}
  <h5><a href="{{ '/archive/' | relative_url }}">FEATURED TAGS</a></h5>

  {%- comment -%} Gather all docs {%- endcomment -%}
  {% assign research   = site.research   %}{% if research   == nil %}{% assign research   = '' | split: '' %}{% endif %}
  {% assign festivals   = site.festivals   %}{% if festivals   == nil %}{% assign festivals   = '' | split: '' %}{% endif %}
  {% assign creative_writing   = site.creative_writing   %}{% if creative_writing   == nil %}{% assign creative_writing   = '' | split: '' %}{% endif %}
  {% assign moderations = site.moderations %}{% if moderations == nil %}{% assign moderation = '' | split: '' %}{% endif %}
  {% assign poetry     = site.poetry     %}{% if poetry     == nil %}{% assign poetry     = '' | split: '' %}{% endif %}

  {% assign all = research | concat: festivals | concat: moderations | concat: creative_writing | concat: poetry %}
  {% assign all = all | where_exp: "i", "i.date" %}
  {% assign total = all.size %}

  {%- comment -%} Build unique tag list {%- endcomment -%}
  {% capture tag_str %}{% endcapture %}
  {% for d in all %}
    {% if d.tags %}
      {% for t in d.tags %}
        {% capture tag_str %}{{ tag_str }}|{{ t | strip }}{% endcapture %}
      {% endfor %}
    {% endif %}
  {% endfor %}
  {% assign uniq = tag_str | split: "|" | uniq | sort_natural %}
  {% assign uniq = uniq | where_exp: "t", "t != ''" %}

  <div class="tags">
    {% capture tags %}
    {% for t in uniq %}
      {% assign count = all | where_exp: "i", "i.tags and i.tags contains t" | size %}
      {% if count > site.featured-condition-size %}
        <a
          data-sort="{{ total | minus: count | prepend: '0000' | slice: -4, 4 }}"
          href="{{ '/archive/' | relative_url }}?tag={{ t | url_encode }}"
          title="{{ t }}" rel="{{ count }}">{{ t }}</a>__SEPARATOR__
      {% endif %}
    {% endfor %}
    {% endcapture %}
    {{ tags | split:'__SEPARATOR__' | sort }}
  </div>
</section>
{% endif %}
